---
title: "Assignment 02"
author: "Réka Forgó"
date: "2025-10-31"
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  echo = TRUE,          # show code
  comment = "",         # removes the leading '#'
  message = FALSE,      # suppress package load messages
  warning = FALSE,      # suppress warnings
  fig.align = "left", # center figures
  fig.width = 7,        # control figure width
  fig.height = 4     # control figure height
)

```

## Assignment 02

Correlation and Regression

### Part 1
Use the ‘divorce_margarine’ dataset from the ‘dslabs’ package to explore the relationship between margarine consumption and divorce rates in Maine. Visualise the data, make a correlation test. Report the correlation coefficient and p-value in APA format, and briefly discuss the results in a practical way.

```{r}
pacman::p_load(ggplot2, dplyr, tidyr, dslabs, car, pastecs, broom, performance, see)
```


```{r}

df <- as.data.frame(divorce_margarine)
head(df)

```

**The dataset: **

*Columns:*
year: year,
divorce_rate: Divorce rate in Maine(per 1000 people),
margarine_consumption: Margarine consumption per capita in US(lbs).
The dataset contains datapoints for 10 different years, from 2000 to 2009.


```{r, warnings= FALSE}
#normality checks

ggplot(df, aes(x = divorce_rate_maine)) +
  geom_histogram(aes(y = ..density..), bins = 15, 
                 fill = "palevioletred", color = "black") +
  geom_density(color = "red", linewidth = 1) +
  labs(title = "Distribution of divorce rate in Maine", 
       x = "Divorce Rate", y = "Density") +
  theme_minimal()

ggplot(df, aes(x = margarine_consumption_per_capita)) +
  geom_histogram(aes(y = ..density..), bins = 15, 
                 fill = "goldenrod1", color = "black") +
  geom_density(color = "red", linewidth = 1) +
  labs(title = "Distribution of margarine consumption", 
       x = "Margarine Consumption", y = "Density") +
  theme_minimal()

ggplot(df, aes(sample = divorce_rate_maine)) + 
  stat_qq(color = "palevioletred") + 
  stat_qq_line(color = "red") +
  labs(title = "Q-Q Plot: Divorce Rate Maine") +
  theme_minimal()

ggplot(df, aes(sample = margarine_consumption_per_capita)) + 
  stat_qq(color = "goldenrod1") + 
  stat_qq_line(color = "red") +
  labs(title = "Q-Q Plot: Margarine Consumption") +
  theme_minimal()

```
We can see that we have very few data points, so the histograms are not very informative. The Q-Q plots show that the data points are roughly following the diagonal line, which suggests that the data is approximately normally distributed.

```{r}
shapiro.test(df$divorce_rate_maine)
shapiro.test(df$margarine_consumption_per_capita) 

round(pastecs::stat.desc(cbind(df$divorce_rate_maine, 
                               df$margarine_consumption_per_capita), 
                         basic = FALSE, norm = TRUE), digits = 2)
```
For both the divorce rate and margarine consumption, the Shapiro-Wilk test yields *p* values greater than .05, which means we can treat the data as approximately normally distributed. Both *W* statistic values are close to 1 further supporting the assumption of normality. We can continue with a Pearson correlation test. (For this simple correlation test we don't need to standardize)

```{r, warnings= FALSE}
cor.test(df$divorce_rate_maine, 
         df$margarine_consumption_per_capita, 
         method = "pearson")

#visualise both variables on one plot by year

ggplot(df, aes(x = year)) +
  geom_line(aes(y = scale(divorce_rate_maine), 
                color = "Divorce Rate in Maine"), linewidth = 1) +
  geom_line(aes(y = scale(margarine_consumption_per_capita), 
                color = "Margarine Consumption per Capita"), linewidth = 1) +
  scale_x_continuous(breaks = 2000:2009) +
  scale_color_manual(values = c("Divorce Rate in Maine" = "palevioletred",
                                "Margarine Consumption per Capita" = "goldenrod1")) +
  labs(
    title = "Divorce Rate and Margarine Consumption in Maine (2000–2009)",
    subtitle = "Standardized (z-score) values for comparison",
    x = "Year", y = "Standardized Value (z)"
  ) +
  theme_minimal() +
  theme(legend.title = element_blank(), legend.position = "top")
```
A Pearson correlation coefficient was computed to assess the linear relationship between divorce rate and margarine consumption in Maine. There was a statistically significant positive correlation between the two variables, *r*(8) = .99, *p* < .001, the CI was [.967, .998].

In other words, there seems to be a positive correlation between margarine consumption and divorce rates in Maine, meaning the changes in margarine is consumption are associated with changes in divorce rates. 

However, correlation does not mean causation, simply that margarine consumption and divorce rates seem to change together. There could be other factors that influence both variables, or it could be a coincidence.


### Part 2

Work with the ‘GSSvocab’ dataset from the ‘car’ package, focusing only on the year 1978 (subset that year and exclude missing values). Investigate how vocabulary test scores (vocab) are related to education (educ). Present the relationship in a plot, fit a regression model, and report results in APA format (coefficients, p-values, and R2), followed by a short practical interpretation.

Extend the analysis by making a new model, where you include whether a person is native- born (nativeBorn) as a predictor. Again, visualise and model the relationship. Consider whether education and native-born status interact in predicting vocabulary, and if so, fit an interaction model. For each model, report results in APA format and explain the practical meaning.

Finally, compare the models and discuss which one performs best based on p-values and R2, as well as the real-world interpretability of the result.

```{r}
df2 <- as.data.frame(GSSvocab)

#subsetting
df2 <- df2 %>%
  filter(year == 1978) %>%
  drop_na()

head(df2)

```

**Dataset**

*Columns:*
year: year of the survey,
gender: gender,
nativeBorn: whether the respondent is native-born,
ageGroup: age group of the respondent,
educGroup: education group of the respondent,
vocab: vocabulary test score,
age: age of respondent,
educ: years of education.

This subset of the dataset contains 1477 observations from the year 1978.


```{r}
#checking types of variables
str(df2)

```

```{r}
df2 %>%
  group_by(educ) %>%
  summarise(mean_vocab = mean(vocab)) %>%
  ggplot(aes(x = educ, y = mean_vocab)) +
  geom_point(size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  theme_minimal() +
  labs(y = "Mean Vocabulary Score")
```

```{r}
model1 <- lm(vocab ~ educ, data = df2)
summary(model1)
```
A simple linear regression showed that education significantly predicted vocabulary scores, *F*(1, 1475) = 597.50, *p* < .001, explaining 28.8% of the variance (*R²* = .29). Each additional year of education was associated with an increase of 0.39 points in vocabulary score (*b* = 0.39, SE = 0.02, *t* = 24.44, *p* < .001).


```{r}
model2 <- lm(vocab ~ educ + nativeBorn, data = df2)
summary(model2)
```
A multiple linear regression was conducted to test whether education and being native-born predict vocabulary scores. The overall model was significant, *F*(2, 1474) = 305.60, *p* < .001, explaining 29.3% of the variance in vocabulary scores (*R²* = .29, adjusted *R²* = .29). Education was a significant predictor (*b* = 0.39, SE = 0.02, *t* = 24.50, *p* < .001). This means each additional year of education was associated with a 0.39-point increase in vocabulary score. Native-born respondents scored on average 0.65 points higher than non-native respondents (*b* = 0.65, SE = 0.21, *t* = 3.16, *p* = .002), holding education constant.

To conclude, vocabulary scores seem to increase with education, and even after accounting for education, native-born individuals tend to score slightly higher than foreign-born individuals.

```{r}
df2 %>%
  group_by(educ, nativeBorn) %>%
  summarise(mean_vocab = mean(vocab), .groups = "drop") %>%
  ggplot(aes(x = factor(educ), y = mean_vocab, color = nativeBorn, group = nativeBorn)) +
  geom_point(size = 2) +
  geom_line() +
  theme_minimal() +
  labs(
    title = "Mean Vocabulary Score by Education and Native-Born Status",
    x = "Years of Education",
    y = "Mean Vocabulary Score",
    color = "Native-Born"
  )
```
```{r}
model3 <- lm(vocab ~ educ * nativeBorn, data = df2)
summary(model3)
```
Last but not least, a linear regression with an interaction between education and native-born status was fitted to predict vocabulary scores. The overall model was significant, *F*(3, 1473) = 203.70, *p* < .001, explaining 29.3% of the variance (*R²* = .293, adjusted *R²* = .292). Education remained a significant predictor of vocabulary scores (*b* = 0.42, SE = 0.05, *p* < .001).
Native-born status alone was not a significant predictor after accounting for the interaction (*b* = 0.95, *p* = .186). Crucially, the interaction term between education and native-born status was not significant (*b* = –0.03, SE = 0.06, *t* = –0.44, *p* = .663), indicating that the effect of education on vocabulary does not differ between native-born and non-native respondents.

Education seems to predict vocabulary scores for both native-born and non-native individuals. Being native-born does not meaningfully change how education influences vocabulary performance.


```{r}
anova(model1, model2, model3)
```

An ANOVA was conducted to compare the three previous models. It shows, that adding native-born status significantly improved model fit over education alone, *F*(1, 1474) = 10.01, *p* = .0016, reducing the residual sum of squares slightly. But including the interaction between education and native-born status did not significantly improve the model, *F*(1, 1473) = 0.19, *p* = .663, with almost no change in the residual sum of squares.

**Checking model assumptions**

```{r, fig.width=6, fig.height=8}
check_model(model1, base_size=6, size_dot=0.9, size_line=0.5)
```

```{r, fig.width=6, fig.height=8}
check_model(model2, base_size=6, size_dot=0.9, size_line=0.5)
```

```{r, fig.width=6, fig.height=8}
check_model(model3, base_size=6, size_dot=0.9, size_line=0.5)
```

Residuals showed no major violations of model assumptions for model 1, 2 or 3. For the homogeneity of variance plots, shows a slight nonlinear pattern which can be assumed to likely be due to the discrete nature of the variables. Therefore, the assumption of equal variance is considered acceptable.

#### Short results description

From these results, we could say that education can be a predictor of vocabulary scores - with each additional year of schooling linked to higher vocabulary scores,- and being native-born explains a small, but significant additional amount of this variance. However, the effect of education does not differ between native-born and non-native individuals (model 3). Furthermore, many other variables, like social class, income, parental education, cognitive ability, etc could explain part of the relationship between education and vocabulary scores. We also cannot infer causality, since higher education may lead to higher vocabulary, but it’s also possible that individuals with higher language ability stay in education longer.
